{% extends 'tsj_core/base_page.html' %}
{% load thinkspace_pages tsj_builder_tags tsj_ui_tags %}
{% load render_mt_bundle from tsj_ui_tags %}

{% block css %}{{ block.super }}
    {% render_mt_bundle 'gemstone' 'css' 'CORE' %}
{% endblock css %}

{% block js %}{{ block.super }}
    {% render_mt_bundle 'gemstone' 'js' 'CORE' %}
    {% render_mt_bundle 'tsjbuilder' 'js' 'CORE' %}
    <script type="text/javascript">
        DIAMOND_LIST_URL = '{% page 'gemstone-list' %}'
        COLORS = [{% for color in colors %}"{{ color.abbr }}"{% if not forloop.last %},{% endif %}{% endfor %}]
        COLORS_RANGE = [{% for color in colors %}"{{ color.abbr }}"{% if not forloop.last %},{% endif %}{% endfor %}]
        GRADINGS = [{% for grading in gradings %}"{{ grading.name }}"{% if not forloop.last %},{% endif %}{% endfor %}]
        GRADINGS_RANGE = [{% for grading in gradings %}"{{ grading.abbr }}"{% if not forloop.last %},{% endif %}{% endfor %}]
        CLARITIES = [{% for clarity in clarities %}"{{ clarity.abbr }}"{% if not forloop.last %},{% endif %}{% endfor %}]
        CLARITIES_RANGE = [{% for clarity in clarities %}"{{ clarity.abbr }}"{% if not forloop.last %},{% endif %}{% endfor %}]
        FLUORESCENCES = [{% for fluorescence in fluorescences %}"{{ fluorescence.name }}"{% if not forloop.last %},{% endif %}{% endfor %}]
        FLUORESCENCES_RANGE = [{% for fluorescence in fluorescences %}"{{ fluorescence.abbr }}"{% if not forloop.last %},{% endif %}{% endfor %}]

        $("#price").ionRangeSlider({
            min: {{ prices.min }},
            max: {{ prices.max }},
            from: {{ filterset.data.price_0 }},
            to: {{ filterset.data.price_1 }},
            hide_min_max: true,
            hide_from_to: true,
            onFinish: function(data) {
                updateResults();
            }
        });
        var price_slider = $('#price').data('ionRangeSlider');

        $("#carat_weight").ionRangeSlider({
            min: {{ carat_weights.min }},
            max: {{ carat_weights.max }},
            from: {{ filterset.data.carat_weight_0 }},
            to: {{ filterset.data.carat_weight_1 }},
            hide_min_max: true,
            hide_from_to: true,
            onFinish: function(data) {
                updateResults();
            }
        });
        var carat_weight_slider = $('#carat_weight').data('ionRangeSlider');

        $('#color').ionRangeSlider({
            hide_min_max: true,
            hide_from_to: true,
            values: COLORS,
            onFinish: function(data) {
                updateResults();
            }
        });

        $('#cut_grade').ionRangeSlider({
            hide_min_max: true,
            hide_from_to: true,
            values: GRADINGS,
            onFinish: function(data) {
                updateResults();
            }
        });

        $('#clarity').ionRangeSlider({
            hide_min_max: true,
            hide_from_to: true,
            values: CLARITIES,
            onFinish: function(data) {
                updateResults();
            }
        });

        $('#polish').ionRangeSlider({
            hide_min_max: true,
            hide_from_to: true,
            values: GRADINGS,
            onFinish: function(data) {
                updateResults();
            }
        });

        $('#symmetry').ionRangeSlider({
            hide_min_max: true,
            hide_from_to: true,
            values: GRADINGS,
            onFinish: function(data) {
                updateResults();
            }
        });

        $('#fluorescence').ionRangeSlider({
            hide_min_max: true,
            hide_from_to: true,
            values: FLUORESCENCES,
            onFinish: function(data) {
                updateResults();
            }
        });

        function updateResults(url) {
            // Set some defaults
            if (url) {
                var href = url += "&" + $('#form-gemstone').serialize();
            } else {
                var url = DIAMOND_LIST_URL;
                var href = "?" + $('#form-gemstone').serialize();
            }

            href = href.replace(/%24/g, '').replace(/%2C/g, '');

            History.pushState(null, null, href);
            return false;
        }
    </script>
{% endblock js %}

{% block bodyclass %}{{ block.super }} gemstone-list{% endblock %}

{% block breadcrumb-trail-last %}
<li class="nav-item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a href="{{ tspages_page.url|absolute_uri:request }}" itemscope itemtype="http://schema.org/Thing" itemprop="item">
        <span itemprop="name"> Diamonds</span>
        <meta itemprop="position" content="2" />
    </a>
</li>
{% endblock breadcrumb-trail-last %}

{% block content %}
    <div class="row hidden-print">
        <div class="column col-xs-12">
            {% widget_dock above_content %}
        </div>
    </div>
    <div class="row row-ringbuilder hidden-print">
        <div class="column col-xs-12">
            {% ring_builder_steps 'diamond' %}
        </div>
    </div>
    <div class="row">
        <div class="section-filters col-md-12">
            {% include "tsj_gemstone/includes/filterset_site.html" %}
        </div>
        <div class="section-content col-md-12">
            <div class="section-gemstones">
                {% include "tsj_gemstone/includes/gemstones.html" %}
            </div>
            <div class="section-pagination bottom">
                {% include "tsj_gemstone/includes/pagination.html" %}
            </div>
        </div>
    </div>
    <div class="row hidden-print">
        <div class="column col-xs-12">
            {% widget_dock below_content %}
        </div>
    </div>
{% endblock content %}
